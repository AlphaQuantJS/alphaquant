# @alphaquant/core

`@alphaquant/core` - высокопроизводительный модуль для обработки табличных данных, числовых преобразований и статистических операций в рамках платформы [AlphaQuantJS](https://github.com/alphaquant).

Построен на основе собственной реализации `TinyFrame`, оптимизированной для работы с финансовыми временными рядами и крупномасштабными наборами данных.

---

## Возможности

### Основная функциональность

- `AQDataFrame` — цепочечная функциональная обертка над TinyFrame
- Чистый ESM, нулевые зависимости в рантайме
- Полное покрытие тестами Jest

### Предобработка

- `dropNaN()` — удаление строк с отсутствующими значениями
- `normalize()` — масштабирование значений в диапазон `[0, 1]`
- `zscore()` — стандартизация (z-преобразование)
- `resample()` — агрегация на основе дат
- `rollingMean()` — скользящее среднее
- `fillNaN()` — базовое заполнение значениями

### Статистика

- `mean()`, `std()` — статистика на уровне колонок
- `corrMatrix()` — вычисление корреляционной матрицы

### Утилиты для работы с фреймами

- `join()`, `concat()`, `pivot()`, `melt()`
- `aggregate()`, `groupByAgg()`, `applyMap()`, `describe()`
- `diff()`, `cumsum()`, `percentChange()`, `shift()`
- Безопасные проверки типов, валидация схемы

---

## Миграция с data-forge на TinyFrame

В рамках оптимизации производительности мы заменили библиотеку data-forge на собственную реализацию TinyFrame, что позволило:

1. **Повысить производительность** - операции выполняются в 2-10 раз быстрее
2. **Снизить потребление памяти** - использование TypedArray вместо обычных массивов
3. **Улучшить типизацию** - полная поддержка JSDoc и TypeScript
4. **Упростить API** - более интуитивный и последовательный интерфейс
5. **Убрать зависимости** - нулевые внешние зависимости в рантайме

### Основные улучшения

- Использование `TypedArray` (Float64Array) для числовых данных
- Оптимизированные алгоритмы для статистических операций
- Улучшенная обработка ошибок и краевых случаев
- Кэширование результатов вычислений
- Векторизованные операции для повышения производительности

---

## Сравнение производительности (TinyFrame vs pandas)

| Операция        | TinyFrame | Pandas  | TF Память | Pandas Память | Разница              |
| --------------- | --------- | ------- | --------- | ------------- | -------------------- |
| `rollingMean()` | 450.12ms  | 3.91ms  | 35.45 MB  | 0.12 MB       | ❌ 115x медленнее    |
| `normalize()`   | 180.35ms  | 5.80ms  | 30.40 MB  | 4.00 MB       | ❌ 31x медленнее     |
| `zscore()`      | 165.21ms  | 4.72ms  | 30.50 MB  | 3.62 MB       | ❌ 35x медленнее     |
| `corrMatrix()`  | 85.32ms   | 9.45ms  | 15.21 MB  | 0.38 MB       | ❌ 40x больше памяти |
| `resample()`    | 95.45ms   | 4.83ms  | 18.42 MB  | 0.88 MB       | ❌ 20x медленнее     |
| `dropNaN()`     | 55.23ms   | 26.12ms | 18.35 MB  | 6.42 MB       | ✅ В 2x быстрее      |

> ⚠️ Тестирование проводилось на 100,000 строках с использованием `benchmark_tiny.js`

---

## Начало работы

### Установка

```bash
npm install @alphaquant/core
```

### Базовое использование

```javascript
import { AQDataFrame } from '@alphaquant/core';

// Создание фрейма данных
const df = new AQDataFrame({
  date: ['2023-01-01', '2023-01-02', '2023-01-03'],
  price: [100, 105, 102],
  volume: [1000, 1500, 800],
});

// Базовые операции
const result = df
  .setIndex('date')
  .normalize('price')
  .rollingMean('price', 2)
  .dropNaN();

console.log(result.toArray());
```

### Корреляционная матрица

```javascript
import { AQDataFrame } from '@alphaquant/core';

const df = new AQDataFrame({
  a: [1, 2, 3, 4, 5],
  b: [5, 4, 3, 2, 1],
  c: [1, 2, 3, 4, 5],
});

const corr = df.corrMatrix();
console.log(corr.toArray());
```

---

## Дальнейшие улучшения

- [ ] Дальнейшая оптимизация производительности критичных операций
- [ ] Добавление поддержки WebAssembly для вычислительно сложных операций
- [ ] Расширение API для работы с временными рядами
- [ ] Улучшение документации и примеров использования
- [ ] Интеграция с экосистемой TensorFlow.js
